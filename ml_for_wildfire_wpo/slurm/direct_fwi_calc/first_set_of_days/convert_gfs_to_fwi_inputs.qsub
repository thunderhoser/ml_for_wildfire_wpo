#!/bin/tcsh

#SBATCH --job-name="convert_gfs_to_fwi_inputs"
#SBATCH --partition="fge"
#SBATCH --account="rda-ghpcs"
#SBATCH --qos="batch"
#SBATCH --ntasks=1
#SBATCH --nodes=1
#SBATCH --cpus-per-task=1
##SBATCH --nodes=1
##SBATCH --ntasks=1
##SBATCH --cpus-per-task=1
##SBATCH --ntasks-per-node=1
#SBATCH --time=03:30:00
#SBATCH --array=1,13,25,37,49,61,73,85,97,109,121,133,145,157,169,181,193,205,217,229,241,253,265,277,289,301,313,325,337,349,361,373,385,397,409,421,433,445,457,469,481,493,505,517,529,541,553,565,577,589,601,613,625,637,649,661,673,685,697,709,721,733,745,757,769,781,793,805
#SBATCH --exclude=h28n12
##SBATCH --exclude=h31n03,h28n12
##SBATCH --exclude=h29n01,h26n05,h28n06,h29n07,h30n03,h30n15
#SBATCH --mail-type=BEGIN,END,FAIL
#SBATCH --mail-user=ryan.lagerquist@noaa.gov
#SBATCH --output=convert_gfs_to_fwi_inputs_%A_%a.out

module load cuda/10.1
source /scratch2/BMC/gsd-hpcs/Jebb.Q.Stewart/conda3.7/etc/profile.d/conda.csh
conda activate base

set CODE_DIR_NAME="/scratch1/RDARCH/rda-ghpcs/Ryan.Lagerquist/ml_for_wildfire_wpo_standalone/ml_for_wildfire_wpo"
set INPUT_DIR_NAME="/scratch1/RDARCH/rda-ghpcs/Ryan.Lagerquist/ml_for_wildfire_wpo_project/gfs_data/direct_fwi_calc/processed"
set OUTPUT_DIR_NAME="${INPUT_DIR_NAME}/daily"

set INIT_DATE_STRINGS=("20190101" "20190102" "20190103" "20190104" "20190105" "20190106" "20190107" "20190108" "20190109" "20190110" "20190111" "20190112" "20190113" "20190114" "20190115" "20190116" "20190117" "20190118" "20190119" "20190120" "20190121" "20190122" "20190123" "20190124" "20190125" "20190126" "20190127" "20190128" "20190129" "20190130" "20190131" "20190201" "20190202" "20190203" "20190204" "20190205" "20190206" "20190207" "20190208" "20190209" "20190210" "20190211" "20190212" "20190213" "20190214" "20190215" "20190216" "20190217" "20190218" "20190219" "20190220" "20190221" "20190222" "20190223" "20190224" "20190225" "20190226" "20190227" "20190228" "20190301" "20190302" "20190303" "20190304" "20190305" "20190306" "20190307" "20190308" "20190309" "20190310" "20190311" "20190312" "20190313" "20190314" "20190315" "20190316" "20190317" "20190318" "20190319" "20190320" "20190321" "20190322" "20190323" "20190324" "20190325" "20190326" "20190327" "20190328" "20190329" "20190330" "20190331" "20190401" "20190402" "20190403" "20190404" "20190405" "20190406" "20190407" "20190408" "20190409" "20190410" "20190411" "20190412" "20190413" "20190414" "20190415" "20190416" "20190417" "20190418" "20190419" "20190420" "20190421" "20190422" "20190423" "20190424" "20190425" "20190426" "20190427" "20190428" "20190429" "20190430" "20190501" "20190502" "20190503" "20190504" "20190505" "20190506" "20190507" "20190508" "20190509" "20190510" "20190511" "20190512" "20190513" "20190514" "20190515" "20190516" "20190517" "20190518" "20190519" "20190520" "20190521" "20190522" "20190523" "20190524" "20190525" "20190526" "20190527" "20190528" "20190529" "20190530" "20190531" "20190601" "20190602" "20190603" "20190604" "20190605" "20190606" "20190607" "20190608" "20190609" "20190610" "20190611" "20190612" "20190613" "20190614" "20190615" "20190616" "20190617" "20190618" "20190619" "20190620" "20190621" "20190622" "20190623" "20190624" "20190625" "20190626" "20190627" "20190628" "20190629" "20190630" "20190701" "20190702" "20190703" "20190704" "20190705" "20190706" "20190707" "20190708" "20190709" "20190710" "20190711" "20190712" "20190713" "20190714" "20190715" "20190716" "20190717" "20190718" "20190719" "20190720" "20190721" "20190722" "20190723" "20190724" "20190725" "20190726" "20190727" "20190728" "20190729" "20190730" "20190731" "20190801" "20190802" "20190803" "20190804" "20190805" "20190806" "20190807" "20190808" "20190809" "20190810" "20190811" "20190812" "20190813" "20190814" "20190815" "20190816" "20190817" "20190818" "20190819" "20190820" "20190821" "20190822" "20190823" "20190824" "20190825" "20190826" "20190827" "20190828" "20190829" "20190830" "20190831" "20190901" "20190902" "20190903" "20190904" "20190905" "20190906" "20190907" "20190908" "20190909" "20190910" "20190911" "20190912" "20190913" "20190914" "20190915" "20190916" "20190917" "20190918" "20190919" "20190920" "20190921" "20190922" "20190923" "20190924" "20190925" "20190926" "20190927" "20190928" "20190929" "20190930" "20191001" "20191002" "20191003" "20191004" "20191005" "20191006" "20191007" "20191008" "20200101" "20200102" "20200103" "20200104" "20200105" "20200106" "20200107" "20200108" "20200109" "20200110" "20200111" "20200112" "20200113" "20200114" "20200115" "20200116" "20200117" "20200118" "20200119" "20200120" "20200121" "20200122" "20200123" "20200124" "20200125" "20200126" "20200127" "20200128" "20200129" "20200130" "20200131" "20200201" "20200202" "20200203" "20200204" "20200205" "20200206" "20200207" "20200208" "20200209" "20200210" "20200211" "20200212" "20200213" "20200214" "20200215" "20200216" "20200217" "20200218" "20200219" "20200220" "20200221" "20200222" "20200223" "20200224" "20200225" "20200226" "20200227" "20200228" "20200229" "20200301" "20200302" "20200303" "20200304" "20200305" "20200306" "20200307" "20200308" "20200309" "20200310" "20200311" "20200312" "20200313" "20200314" "20200315" "20200316" "20200317" "20200318" "20200319" "20200320" "20200321" "20200322" "20200323" "20200324" "20200325" "20200326" "20200327" "20200328" "20200329" "20200330" "20200331" "20200401" "20200402" "20200403" "20200404" "20200405" "20200406" "20200407" "20200408" "20200409" "20200410" "20200411" "20200412" "20200413" "20200414" "20200415" "20200416" "20200417" "20200418" "20200419" "20200420" "20200421" "20200422" "20200423" "20200424" "20200425" "20200426" "20200427" "20200428" "20200429" "20200430" "20200501" "20200502" "20200503" "20200504" "20200505" "20200506" "20200507" "20200508" "20200509" "20200510" "20200511" "20200512" "20200513" "20200514" "20200515" "20200516" "20200517" "20200518" "20200519" "20200520" "20200521" "20200522" "20200523" "20200524" "20200525" "20200526" "20200527" "20200528" "20200529" "20200530" "20200531" "20200601" "20200602" "20200603" "20200604" "20200605" "20200606" "20200607" "20200608" "20200609" "20200610" "20200611" "20200612" "20200613" "20200614" "20200615" "20200616" "20200617" "20200618" "20200619" "20200620" "20200621" "20200622" "20200623" "20200624" "20200625" "20200626" "20200627" "20200628" "20200629" "20200630" "20200701" "20200702" "20200703" "20200704" "20200705" "20200706" "20200707" "20200708" "20200709" "20200710" "20200711" "20200712" "20200713" "20200714" "20200715" "20200716" "20200717" "20200718" "20200719" "20200720" "20200721" "20200722" "20200723" "20200724" "20200725" "20200726" "20200727" "20200728" "20200729" "20200730" "20200731" "20200801" "20200802" "20200803" "20200804" "20200805" "20200806" "20200807" "20200808" "20200809" "20200810" "20200811" "20200812" "20200813" "20200814" "20200815" "20200816" "20200817" "20200818" "20200819" "20200820" "20200821" "20200822" "20200823" "20200824" "20200825" "20210101" "20210102" "20210103" "20210104" "20210105" "20210106" "20210107" "20210108" "20210109" "20210110" "20210111" "20210112" "20210113" "20210114" "20210115" "20210116" "20210117" "20210118" "20210119" "20210120" "20210121" "20210122" "20210123" "20210124" "20210125" "20210126" "20210127" "20210128" "20210129" "20210130" "20210131" "20210201" "20210202" "20210203" "20210204" "20210205" "20210206" "20210207" "20210208" "20210209" "20210210" "20210211" "20210212" "20210213" "20210214" "20210215" "20210216" "20210217" "20210218" "20210219" "20210220" "20210221" "20210222" "20210223" "20210224" "20210225" "20210226" "20210227" "20210228" "20210301" "20210302" "20210303" "20210304" "20210305" "20210306" "20210307" "20210308" "20210309" "20210310" "20210311" "20210312" "20210313" "20210314" "20210315" "20210316" "20210317" "20210318" "20210319" "20210320" "20210321" "20210322" "20210323" "20210324" "20210325" "20210326" "20210327" "20210328" "20210329" "20210330" "20210331" "20210401" "20210402" "20210403" "20210404" "20210405" "20210406" "20210407" "20210408" "20210409" "20210410" "20210411" "20210412" "20210413" "20210414" "20210415" "20210416" "20210417" "20210418" "20210419" "20210420" "20210421" "20210422" "20210423" "20210424" "20210425" "20210426" "20210427" "20210428" "20210429" "20210430" "20210501" "20210502" "20210503" "20210504" "20210505" "20210506" "20210507" "20210508" "20220101" "20220102" "20220103" "20220104" "20220105" "20220106" "20220107" "20220108" "20220109" "20220110" "20220111" "20220112" "20220113" "20220114" "20220115" "20220116" "20220117" "20220118" "20220119" "20220120" "20220121" "20220122" "20220123" "20220124" "20220125" "20220126" "20220127" "20220128" "20220129" "20220130" "20220131" "20220201" "20220202" "20220203" "20220204" "20220205" "20220206" "20220207" "20220208" "20220209" "20220210" "20220211" "20220212" "20220213" "20220214" "20220215" "20220216" "20220217" "20220218" "20220219" "20220220" "20220221" "20220222" "20220223" "20220224" "20220225" "20220226" "20220227" "20220228" "20220301" "20220302" "20220303" "20220304" "20220305" "20220306" "20220307" "20220308" "20220309" "20220310" "20220311" "20220312" "20220313" "20220314" "20220315" "20220316" "20220317" "20220318" "20220319" "20220320" "20220321" "20220322" "20220323" "20220324" "20220325" "20220326" "20220327" "20220328" "20220329" "20220330" "20220331" "20220401" "20220402" "20220403" "20220404" "20220405" "20220406" "20220407" "20220408" "20220409" "20220410" "20220411" "20220412" "20220413" "20220414" "20220415" "20220416" "20220417" "20220418" "20220419" "20220420" "20220421" "20220422" "20220423" "20220424" "20220425" "20220426" "20220427" "20220428" "20220429" "20220430" "20220501" "20220502" "20220503" "20220504" "20220505" "20220506" "20220507" "20220508" "20220509" "20220510" "20220511" "20220512" "20220513" "20220514" "20220515" "20220516" "20220517" "20220518" "20220519" "20220520" "20220521" "20220522" "20220523" "20220524" "20220525" "20220526" "20220527" "20220528" "20220529" "20220530" "20220531" "20220601" "20220602" "20220603" "20220604" "20220605" "20220606" "20220607" "20220608" "20220609" "20220610")
set i=$SLURM_ARRAY_TASK_ID

while ($i <= `expr $SLURM_ARRAY_TASK_ID + 11` && $i <= $#INIT_DATE_STRINGS)
    set init_date_string="${INIT_DATE_STRINGS[$i]}"
    
    python3 -u "${CODE_DIR_NAME}/convert_gfs_to_daily_fwi_inputs.py" \
    --input_gfs_dir_name="${INPUT_DIR_NAME}" \
    --first_init_date_string="${init_date_string}" \
    --last_init_date_string="${init_date_string}" \
    --max_lead_time_days=14 \
    --output_daily_gfs_dir_name="${OUTPUT_DIR_NAME}"
    
    @ i = $i + 1
end
